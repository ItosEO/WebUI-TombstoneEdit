# 自动构建系统说明

## 概述
本项目已配置GitHub Actions自动构建系统，可以在推送版本标签时自动构建和发布KernelSU模块。

## 使用方法

### 1. 创建新版本
当你准备发布新版本时，按照以下步骤操作：

```bash
# 1. 更新模块版本（可选）
# 编辑 module/module.prop 文件中的version字段

# 2. 提交所有更改
git add .
git commit -m "准备发布 v1.0.2"
git push

# 3. 创建版本标签
git tag v1.0.2 -m "发布版本 1.0.2"

# 4. 推送标签触发构建
git push origin v1.0.2
```

### 2. 自动构建过程
推送标签后，GitHub Actions会自动：

1. 🔄 **检出代码** - 获取最新源码
2. ⚙️ **设置环境** - 安装Node.js和依赖
3. 🔨 **构建WebUI** - 编译JavaScript和CSS文件
4. 📦 **打包模块** - 创建KernelSU模块zip文件
5. 🚀 **创建发布** - 在GitHub Releases中发布
6. 📎 **上传文件** - 附加模块zip到发布

### 3. 下载和安装
构建完成后：

1. 前往项目的 **Releases** 页面
2. 下载最新的 `.zip` 文件
3. 在KernelSU管理器中安装模块
4. 重启设备使模块生效

## 文件结构

### 源码结构
```
src/                    # WebUI源码
├── index.html         # 主页面
├── js/               # JavaScript模块
└── styles/           # CSS样式
```

### 构建输出
```
module/                # KernelSU模块
├── module.prop       # 模块配置
├── webroot/         # 编译后的WebUI
├── META-INF/        # 安装脚本
└── customize.sh     # 自定义安装脚本
```

## 配置文件

### .github/workflows/build-and-release.yml
GitHub Actions工作流配置文件，定义了自动构建流程。

### package.json
包含了构建脚本和依赖项配置：
- `npm run build` - 构建WebUI
- `kernelsu-stub.js` - 构建时的API存根

### kernelsu-stub.js
提供KernelSU API的构建时替代品，确保在CI环境中可以正常构建。

## 故障排除

### 构建失败
如果自动构建失败，检查：
1. **Actions** 页面查看详细错误日志
2. 确保所有源文件语法正确
3. 检查package.json配置

### 模块安装失败
如果下载的模块无法安装：
1. 确保设备已安装KernelSU
2. 检查模块文件完整性
3. 查看KernelSU日志

## 高级配置

### 修改构建脚本
可以编辑 `.github/workflows/build-and-release.yml` 来：
- 更改Node.js版本
- 添加额外的构建步骤
- 修改发布说明模板
- 调整文件命名规则

### 自定义模块信息
编辑 `module/module.prop` 文件来更新：
- 模块ID和名称
- 版本信息
- 作者信息
- 描述文本

## 注意事项

1. **标签命名**：必须以 `v` 开头（如 v1.0.1, v2.0.0）
2. **权限要求**：需要在设置中启用Actions和Releases权限
3. **构建时间**：通常需要2-3分钟完成整个流程
4. **文件大小**：最终模块约36KB，适合快速下载

## 开发建议

1. **测试优先**：在创建标签前先本地测试构建
2. **版本规范**：遵循语义化版本号规则
3. **更新日志**：在发布说明中详细描述更改
4. **备份重要**：发布前确保重要更改已提交